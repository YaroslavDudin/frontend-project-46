
name: build
on:
  push:
    branches:
      - master
    tags:
      - '!*' # Do not execute on tags
    paths:
      - src/*
      - test/*
      - '*.json'
      - yarn.lock
  pull_request:
    paths:
      - '!*.MD'
jobs:
  test:
    strategy:
      matrix:
        platform: [ ubuntu-latest, macOS-latest ]
        node: [ '12', '10' ]
    name: test/node ${{ matrix.node }}/${{ matrix.platform }}
    runs-on: ${{ matrix.platform }}
    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@master
      with:
        node-version: ${{ matrix.node }}
    - run: npm install -g yarn
    - run: yarn install
    - run: yarn build
    - run: yarn test
  coverage:
    needs: [ test ]
    name: coverage
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@master
      with:
        node-version: '12'
    - run: npm install -g yarn
    - run: yarn install
    - run: yarn build
    - uses: paambaati/codeclimate-action@v2.2.4
      env:
        CC_TEST_REPORTER_ID: 384d0da08a5564e84812aec660494dc57048e411dd5c86cb6ecf5926dee21b5b
      with:
        coverageCommand: yarn coverage


# # Name of workflow
# name: Node CI

# # Trigger the workflow on push or pull request
# on:
#   - push
#   - pull_request

# env:
#   CI: true

# jobs:
#   build:

#     # The type of machine to run the job on
#     runs-on: ubuntu-latest

#     strategy:
#       # Node versions list
#       matrix:
#         node-version: [20.x]

#     steps:
#         # Check-out repository under GitHub workspace
#         # https://github.com/actions/checkout
#       - uses: actions/checkout@v4
#         # Step's name
#       - name: Use Node.js ${{ matrix.node-version }}
#         # Configures the node version used on GitHub-hosted runners
#         # https://github.com/actions/setup-node
#         uses: actions/setup-node@v4
#         # The Node.js version to configure
#         with:
#           node-version: ${{ matrix.node-version }}
#           cache: 'npm'
#       - run:  make test-coverage
#           uses: YaroslavDudin/codeclimate-action@v5.0.0
#          # Add Code Climate secret key
#         env:
#           CC_TEST_REPORTER_ID: ${{ 384d0da08a5564e84812aec660494dc57048e411dd5c86cb6ecf5926dee21b5b }}
#         with:
#            coverageCommand: make test-coverage
#            debug: true
#     coverage:
#     needs: [ test ]
#     name: coverage
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@master
#     - uses: actions/setup-node@master
#       with:
#         node-version: '12'
#     - run: npm install -g yarn
#     - run: yarn install
#     - run: yarn build
#     - uses: paambaati/codeclimate-action@v2.2.4
#       env:
#         CC_TEST_REPORTER_ID: 945dfb58a832d233a3caeb84e3e6d3be212e8c7abcb48117fce63b9adcb43647
#       with:
#         coverageCommand: yarn coverage